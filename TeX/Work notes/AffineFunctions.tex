As in \cite{manchester13planning}, we produce functions of the form
\begin{equation}
	\alpha\left(\theta\right)\ddot{\theta}(t) + \beta\left(\theta\right)\dot{\theta}(t)^2 + \gamma\left(\theta\right) = 0
\end{equation}
with
\begin{eqnarray*}
	\alpha(\theta) &=& B^{\bot}\left(\Phi(\theta)\right)M\left(\Phi(\theta)\right)\Phi'(\theta)\\
	\beta(\theta) &=& B^{\bot}\left(\Phi(\theta)\right)\left(M\left(\Phi(\theta)\right)\Phi''(\theta)
		+C\left(\Phi(\theta),\Phi'(\theta)\right)\Phi'(\theta) \right)\\
	\gamma(\theta) &=& B^{\bot}\left(\Phi(\theta)\right)G\left(\Phi(\theta)\right)\\
\end{eqnarray*}
Then we get the differential equation:
\begin{equation} \label{eqn:diff}
	\frac{d}{d\theta}{\dot{\theta}\left(\theta\right)}^2 = -2\frac{\beta\left(\theta\right)}
	{\alpha\left(\theta\right)}\dot{\theta}\left(\theta\right)^2 - 2\frac{\gamma\left(\theta\right)}
	{\alpha\left(\theta\right)}
\end{equation}

Solving this over any interval $\theta \in \left[\theta_0,\theta_f\right]$ yields
\begin{equation} \label{eqn:affine}
	\dot{\theta}\left(\theta\right)^2 = \Gamma\left(\theta,\theta_0\right)\dot{\theta}^2 
	+ \Psi\left(\theta, \theta_0\right)
\end{equation}

This solution is achieved by using the general method for first-order linear ODEs with varying coefficients, i.e. given
\begin{equation*}
	y'(x) + f(x)y(x) = g(x)
\end{equation*}
the solution is
\begin{equation*}
	y = e^{-\int f(x)dx}\left(\int g(x)e^{\int f(x)dx}dx + \kappa\right)
\end{equation*}
Thus we have
\begin{eqnarray}
	\Gamma(\theta) &=& e^{-\int_{\theta_0}^{\theta}f(x)dx} \\
	\Psi(\theta) &=& e^{-\int_{\theta_0}^{\theta}f(x)dx}
		\int_{\theta_0}^{\theta}g(x)e^{\int_{\theta_0}^{\theta}f(x)dx} \\
	f(x) &=& 2\frac{\beta(x)}{\alpha(x)} \nonumber \\
	g(x) &=& -2\frac{\gamma(x)}{\alpha(x)} \nonumber
\end{eqnarray}

The total mechanical energy of the system is given by
\begin{equation}
	\bar{H}\left(\theta,\dot{\theta}\right) = \Phi'\left(\theta\right)^T M\left(\Phi\left(\theta\right)\right)
	\Phi'\left(\theta\right)\dot{\theta}^2 + V\left(\Psi\left(\theta\right)\right)
\end{equation}
Where M is the symmetric, positive-definite mass/inertia matrix and
\begin{eqnarray*}
	\Phi\left(\theta\right) &=& \left[ q_1, q_2, \ldots, q_n \right]^T \\
	&=& \left[ \phi_1\left(\theta\right), \phi_2\left(\theta\right), \ldots, \phi_n\left(\theta\right)
	\right]^T \\
	\Phi'\left(\theta\right) &=& \left[ \frac{\partial\phi_1\left(\theta\right)}{\partial\theta},
	\frac{\partial\phi_2\left(\theta\right)}{\partial\theta}, \ldots ,
	\frac{\partial\phi_n\left(\theta\right)}{\partial\theta} \right]^T
\end{eqnarray*}

\subsection{Compass Gait with BÃ©zier constraint}
In the case of the compass-gait walker, of course, since there is only one variable other than the phase variable $\theta$, these functions have only two elements each, one of which is trivial. Thus:
\begin{eqnarray*}
	\Phi\left(\theta\right) &=& 
		\begin{bmatrix}
		\theta \\ \phi\left(\theta\right)
		\end{bmatrix} \\
	\Phi'\left(\theta\right) &=& 
		\begin{bmatrix}
		1 \\ \frac{\partial\phi\left(\theta\right)}{\partial\theta}
		\end{bmatrix} \\
	\Phi''\left(\theta\right) &=& 
		\begin{bmatrix}
		0 \\ \frac{\partial^2\phi\left(\theta\right)}{\partial\theta^2}
		\end{bmatrix}
\end{eqnarray*}
Now, we have from Equation~\ref{eqn:expBez} (slightly adapted to suit new coordinate naming):
\begin{equation}
	\phi\left(\theta\right) = \frac{1}{\left(\theta_f-\theta_{0}\right)^n}\sum_{i=0}^{n}\binom{n}{i}
	\left(\theta_f - \theta\right)^{n-i}
	\left(\theta - \theta_{0}\right)^i\vartheta_{i}
\end{equation}
The derivative is
\begin{dmath}
	\frac{\partial\phi}{\partial\theta} = \frac{1}{\left(\theta_f-\theta_0\right)^n}
	\left(
	{n\left( \left(\theta-\theta_0\right)^{n-1}\vartheta_n - 
		\left(\theta_f-\theta\right)^{n-1}\vartheta_0 \right) }
	+ {\sum_{i=1}^{n-1} \binom{n}{i} \left(i\left(\theta_f-\theta\right)^{n-i}
		\left(\theta-\theta_0\right)^{i-1} - 
		\left(n - i\right)\left(\theta_f-\theta\right)^{n-i-1}\left(\theta-
		\theta_0\right)^{i}\right)\vartheta_i}
	\right)
\end{dmath}
The second derivative is
\begin{dmath}
	\frac{\partial^2\phi}{\partial\theta^2} = 
	\frac{1}{(\theta_f-\theta_0)^n}
	\left(
	n(n-1)\left[ (\theta_f-\theta)^{n-2}\vartheta_0 
		+ (\theta-\theta_0)^{n-2}\vartheta_n
	+ (n-2)\left((\theta-\theta_0)(\theta_f-\theta)^{n-3}\vartheta_1
		+ (\theta_f-\theta)(\theta-\theta_0)^{n-3}\vartheta_{n-1} \right)
		- 2\left((\theta_f-\theta)^{n-2}\vartheta_1
		+ (\theta-\theta_0)^{n-2}\vartheta_{n-1} \right) 		\right]
	+ \sum_{i=2}^{n-2} \binom{n}{i} 
		\left({i(i-1)(\theta_f-\theta)^{n-i}(\theta-\theta_0)^{i-2}
			- 2i(n-i)(\theta_f-\theta)^{n-i-1}(\theta-\theta_0)^{i-1}}
			+ (n-i-1)(n-i)(\theta_f-\theta)^{n-i-2}(\theta-\theta_0)^{i} \right)
			\vartheta_i
	\right)
\end{dmath}

Let us choose the simplest non-zero $B^{\bot}$:
\begin{equation*}
	B^{\bot}=\begin{bmatrix} 1 & 0 \end{bmatrix}
\end{equation*}
We also have the following. Note that for simplicity, $\phi(\theta) = \phi$.
\begin{eqnarray*}
	M\left(\Phi(\theta)\right) &=& \begin{bmatrix}
		I_1 + I_2 + m_2\left(l_1^2 + \frac{1}{4}l_2^2 + l_1l_2\cos{\phi}\right) &
		I_2 + \frac{1}{2}m_2\left(\frac{1}{2}l_2^2 + l_1l_2\cos{\phi}\right) \\
		I_2 + \frac{1}{2}m_2\left(\frac{1}{2}l_2^2 + l_1l_2\cos{\phi}\right) &
		I_2 + \frac{1}{4}m_2l_2^2
	\end{bmatrix} \\
	C\left(\Phi(\theta),\Phi'(\theta)\right) &=& \sin({\phi}) \begin{bmatrix}
		-m_2 l_1 l_2 \frac{\partial\phi}{\partial\theta} &
		-\frac{1}{2}m_2 l_1 l_2 \frac{\partial\phi}{\partial\theta} \\
		\frac{1}{2}m_2 l_1 l_2  & 0
	\end{bmatrix} \\
	G\left(\Phi(\theta)\right) &=& \begin{bmatrix}
		\frac{1}{2}l_1m_1g\cos{\theta} + m_2 g \left(l_1 \cos{\theta} + 
		\frac{1}{2}l_2 \cos{\left(\theta + \phi\right)} \right) \\
		\frac{1}{2} m_2 g l_2 \cos{\left(\theta + \phi\right)}
	\end{bmatrix}
\end{eqnarray*}