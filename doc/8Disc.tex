\section{Key observations}
In attempting to build a generalised method for the construction of virtual constraint libraries for the purpose of facilitating motion planning, this thesis has investigated the properties of individual as well as sets of virtual constraints. This investigation has been focused on those features which enable or obstruct the construction of a useful library which is able to be quickly traversed by a selection algorithm.

\subsection{Optimisation feasibility}
The first observation, which encourages the use of optimisation for the generation of the library, is that $p$-norms of the torque are well-shaped in terms of the decision variables (the Bézier coefficients). There is a notable exception to this caused by the numerical interaction of $\alpha(\theta)$ crossing zero and the sampling method used for numerical integration. While it is possible to improve the behaviour by adaptive sampling methods, the solution is susceptible to bad behaviour if the zero crossings are too close to each other in terms of the sampling interval. These zero crossings of $\alpha(\theta)$ form the most significant challenge to the general feasibility of the optimisation problem. It is noted that the behaviour of $\alpha(\theta)$ in terms of zero crossings worsens considerably with increasing values of the Bézier coefficients. Regularisation was used in this thesis as a method of guiding the optimisation away from areas of poor $\alpha(\theta)$ behaviour and avoiding the infeasibility of the constrained minimisation caused by its existence. Introducing this regularisation appears to have no undesirable side-effects in the optimisation.

\subsection{Ordering methods}
Prior to this work, since the method of producing virtual constraints was manual, it was not certain whether it is possible to construct a useful library of motion primitives which are able to be ordered in a manner which is independent of the target velocity. This is an important issue to investigate, since primitive selection algorithms which seek a variable velocity or energy have been shown to significantly reduce the number of traversals through the decision tree \cite{manchester13planning}. The results presented in this thesis are not conclusive, however they suggest that it may be possible to produce useful libraries with this structure with some effort. In the majority of cases, relatively few points in the relevant set violate the conditions for a velocity-independent ordering. This indicates that a library with the required structure may be able to be produced at the cost of sacrificing some of the coverage.

\subsection{Optimality}
In its conception, the virtual constraints method of path planning is concerned with producing feasible rather than optimal paths. This is not unique; in the space of nonlinear high-dimensional constrained optimisations, methods are typically some form of searching for a ``sufficiently good'' feasible path which we may boldly call \textit{approximately optimal} \cite{kavraki1996probabilistic, hwang1992potential, quinlan1993elastic}. This should not discourage us from searching for optimality wherever it can be achieved, particularly given that one of the main motivations for investigating underactuated robots is the increase in efficiency (decrease in required input power) in comparison to the more stable and easier to control fully actuated bipeds. It is therefore still relevant to discuss the optimality of the virtual constraints produced by the methods introduced in this thesis. 

The most significant potential detractor from this optimality is related to the fact that the torque required to maintain a virtual constraint is dependent on the velocity. The results of this work expressed in Figure \ref{fig:singleflattorque} suggest that the torque curves required to maintain a constraint are similar nearby the nominal velocity, therefore it seems safe to assume that the optimality of the constraint is roughly maintained over a region about the nominal velocity. The optimality of a planned path is therefore dependent on the choice of nominal velocity and how closely the velocity is to nominal when the virtual constraint is chosen by the path planner.

This dependence couples with the more general reliance on the efficacy of the selection algorithm. In principle, this thesis is concerned with the generation of the primitives much more than their selection, however a primitive library is entirely limited in its usefulness by the planner which uses it. The power of the planning algorithm is also limited by the data that is presented by the virtual constraint generation. Therefore, while it is true to say that this method of library generation is applicable to many selection algorithms, the optimality under the suggested algorithms should be assessed.

The results in Section \ref{sec:resnom} indicate that the velocities of the virtual constraints in use do not vary significantly from the nominal velocity used in the optimisation. This result can be further improved by tuning the definition of the nominal velocity. This should result in a fairly faithful regulation of the torque expected in the generation of the virtual constraints. We therefore may conclude that the optimisation of the virtual constraints is reflected in the planned path. This, however, does not imply that the optimal choice of constraint is being performed. In this regard, the algorithm chosen is not particularly favourable. Recalling that the main concern is the tractability of the computation, optimality is not the algorithm's key performance indicator.

\subsection{Off-line computational requirements}
Prior to this work, the in-principle low on-line computational costs of using virtual constraints had been discussed \cite{manchester13planning}. The computational requirements for preparing the library had not. It should be noted that the on-line computational requirement is key for the success of the real-time performance of the algorithm. However, if the library takes an infeasible amount of time to produce, these on-line performance metrics count for little. Fortunately, there are several key properties of this method of library production which suggest that, even for extremely large libraries, the computation should be tractable. The first is that the generation of the virtual constraint library is able to be executed in parallel, besides the single point of synchronisation after producing the set of impact configurations $\tilde{Q}$. This means that the library generation can utilise the full power of multi-core and distributed computing very effectively. It is also notable that the time to generate a single virtual constraint is able to be kept reasonably small. Of course, for more complicated robots, this grows, however the results appear to suggest that the complexity of the optimisation problem is quadratic in the number of decision variables, which is significantly more favourable than the exponential growth observed in the size of the search space. Another very compelling notable advantage in terms of preparation time is that it is only necessary to have a fine resolution over one of the dimensions $n_x$ and $n_y$. In addition, it is likely not necessary to produce a large number final configurations per step length and height. This limits the growth in complexity with increasing degrees of freedom in the robot model.

\section{Advantages of virtual constraints method}
The method of using motion primitives defined as virtual constraints for path planning is primarily concerned with reducing the on-line computation requirements such that the planning problem is able to be completed in real-time on embedded systems. Each of the advantages of the method is applicable to that end.

The first and most notable advantage of using primitives is that the optimisation problem is reduced from an infinite dimensional nonlinear program to a simple combinatorial search. By very nature, the unreduced optimisation problem is entirely intractable on any system. Any practicable method of solving the path planning problem will reduce the optimisation at least to some finite set of decision variables. However, the literature shows that the current state of the art in on-line nonlinear optimisation for footstep planning is still far too slow for use in real-time on a walking robot \cite{shkolnik2011bounding}.

Reducing the planning problem to a combinatorial search is in itself not sufficient to allow for real-time motion planning. Consider the size of the primitive library and the exponential growth of the decision tree in the number of footsteps. The worst-case search complexity is very large, and in the best case, it is certain that the kinematic and dynamic feasibility of a number of primitives must be evaluated.

It is here that the definition of the motion primitives as virtual constraints is advantageous. Virtual constraints are prevalent in recent literature as a convenient form of expressing motion for an underactuated dynamic walker due to the resulting explicit definition of the zero dynamics \cite{westervelt2003hybrid, sreenath2011compliant, martin2014design}. This may be exploited to produce a partial closed-form solution of the velocity, which reduces the check for dynamic feasibility, typically the most computationally intensive task of evaluating a path of an underactuated system for suitability, to a trivial single computation step. It is also notable that virtual constraints explicitly define a configuration path which is convenient for the verification of kinematic feasibility.

Virtual constraints also lend themselves to an intelligent structuring of the primitive library which avails rapid on-line searching and avoiding redundant or unnecessary evaluation of the feasibility of a primitive. This is presented in two main ways; firstly, the direct correspondence of the virtual constraint to a path through the configuration space allows the library to be structured hierarchically, indexed by the step length and height of the virtual constraint. Due to this, constraints which are not applicable to the terrain are immediately excluded from consideration. Secondly, the partial solution for velocity provides the basis for an ordering of constraints, which enables a binary rather than linear search through sets of applicable constraints. 

The combination of these advantages culminate in the production of a method by which feasible motion planning for underactuated robots walking over uneven terrain is achievable. Furthermore, as demonstrated by the primary work in this thesis, the virtual constraints are able to be optimised in some sense, which has two key advantages; the torque requirements are able to be reduced in a reliable manner, and the library can be reasonably rapidly automatically constructed.

\section{Limitations of virtual constraints method}
While the virtual constraints method for path planning is useful for reducing the problem to a feasible real-time decision algorithm, it comes with limitations not existent in the alternatives which at present are too computationally intensive. Most of these are a direct result of the limitation of having produced the available motions beforehand rather than in real-time.

The most obvious of these limitations is that this method is ill-suited to spontaneous production of novel motion based upon some disturbance or terrain artefact that renders the motions in the library infeasible. A rich enough set of motion primitives should nullify this disadvantage, however it is not possible in general to produce primitives which provide complete coverage over all possible motions of the robot, particularly since the primitives must be defined by dependence on the phase variable. Any motion for which that coordinate's derivative crosses zero is not permissible. Even so, this limitation is not particularly severe; normal walking motions are able to be described by a monotonic phase variable. It is also worth noting that many on-line path planning methods do not produce paths which guarantee a span of the entire configuration space of the robot \cite{boor1999gaussian, lavalle2001randomized, frazzoli2002real}, therefore the comparative disadvantage of the virtual constraints method in this regard is minimal, provided a rich enough library. 

%A more subtle but significant limitation is that using a pure virtual constraints method for planning and control places no explicit stabilisation on the phase variable. Instead, the method relies on the initial velocity to be sufficient to keep the robot dynamically stable. This implies that the robot will not attempt any explicit method of recovery in the event of disturbances. While this is a large concern, it is quite easily rectified by using a different controller, for instance by using transverse linearisation rather than a pure HZD-based controller \cite{manchester2011stable}.

A more significant limitation is that the simple one dimensional definition of the zero dynamics which produces the useful structure exploited to produce the partial solution is not applicable in systems with higher degrees of underactuation. It is notable that three-dimensional bipeds with point feet have at least two unactuated degrees of freedom. There have been successful attempts in producing hybrid zero dynamics based controllers for simple spatial (3D) robots \cite{shih2007asymptotically}, however the authors concluded that in the general case, an event-based controller may be necessary to synchronise saggital and frontal plane motion.

Beyond the limitations inherent in the general method of virtual constraints for motion planning, there are several limitations introduced in the library generation method proposed in this thesis. The optimisation of the virtual constraint library is only able to be optimised for a particular nominal velocity. This does not place a limitation on the feasibility of walking, provided torque limits are upheld, however power reduction can be a very large consideration in the design of autonomous systems. The extent to which the optimality of the path is compromised is dependent on how closely the nominal velocity used to generate the primitives matches the actual velocity when the primitive is used. In theory, if the nominal velocity matches well with the use cases of the motion primitive, this may not be a large concern.

The brute-force method of connecting every impact configuration in the library to every other impact configuration has the result of causing the library to grow quadratically in the number of step lengths, heights and configurations per step length and height. This limits the coverage of the library over the configuration space of the robot, since fine gridding in any more than one of those dimensions results in an intractably large library. In practice, this should not have a large effect on the usefulness of the library since in theory, a single step length should be sufficient to traverse most terrain, so long as there are no obstacles such as holes over which to step. Even then, a very small number of step lengths should be sufficient.

Conditioned properly and combined with intelligent controllers and a high level planning framework, the virtual constraints method does not have any crippling limitations when compared with its contemporaries. The limitations of this thesis work arise largely due to the absence of both of these. However, the theoretical effectiveness of the proposed method for generating virtual constraints automatically should not suffer.